<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lone Rock Ranch — Family Hub</title>
  <meta name="description" content="Lone Rock Ranch private hub to connect family members—directory, calendar, announcements, and more." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fdf2f2;          /* very light rose */
      --card: #ffffff;        /* white */
      --ink: #2b0d0b;         /* near-black warm */
      --muted: #7c3f3a;       /* muted warm */
      --brand: #7b241c;       /* dark ranch red */
      --brand-2: #a93226;     /* lighter ranch red */
      --ring: rgba(123, 36, 28, 0.35);
      --border: #f1d4d4;      /* pale red border */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: radial-gradient(1000px 600px at 80% -100px, rgba(123,36,28,.06), transparent 60%), var(--bg);
    }
    a { color: var(--brand); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Layout */
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header { position: sticky; top: 0; z-index: 40; background: rgba(253,242,242,.85); backdrop-filter: blur(8px); border-bottom: 1px solid var(--border); }
    .nav { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 14px 24px; }
    .nav a { font-weight: 600; color: var(--ink); padding: 8px 10px; border-radius: 8px; }
    .nav a.active, .nav a:hover { background: #fbeaea; }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 800; letter-spacing: .2px; }
    .brand-badge { width: 34px; height: 34px; border-radius: 10px; background: linear-gradient(135deg, var(--brand), var(--brand-2)); display: grid; place-items: center; color: white; font-weight: 800; box-shadow: 0 6px 20px rgba(123,36,28,.25); }

    /* Banner */
    .banner { background: linear-gradient(180deg, var(--brand), var(--brand-2)); color: #fff; }
    .banner .container { padding: 28px 24px; }
    .banner h1 { font-size: clamp(28px, 4vw, 44px); margin: 0 0 8px; line-height: 1.1; }
    .banner p { margin: 0 0 16px; color: rgba(255,255,255,.9); }
    .banner .btn.primary { background: #fff; color: var(--brand); box-shadow: 0 10px 24px rgba(0,0,0,.15); }
    .banner .btn { border-color: rgba(255,255,255,.35); }

    /* Content cards */
    .hero { padding: 24px; }
    .hero-card { background: var(--card); border: 1px solid var(--border); border-radius: 18px; padding: 28px; box-shadow: 0 10px 30px rgba(2, 6, 23, .05); }
    .cta-row { display: flex; flex-wrap: wrap; gap: 12px; }
    .btn { display: inline-flex; align-items: center; gap: 10px; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border); background: white; font-weight: 600; cursor: pointer; transition: transform .04s ease; }
    .btn:active { transform: translateY(1px); }
    .btn.primary { background: var(--brand); color: white; border-color: transparent; box-shadow: 0 10px 24px rgba(123,36,28,.22); }
    .btn.secondary { background: #fceaea; }

    .quick { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
    .quick .card { padding: 18px; background: var(--card); border: 1px solid var(--border); border-radius: 14px; min-height: 92px; display: grid; gap: 8px; }
    .card h3 { margin: 0; font-size: 16px; }
    .card p { margin: 0; color: var(--muted); font-size: 14px; }

    section { padding: 34px 24px; }
    section h2 { margin: 0 0 12px; font-size: 26px; }
    .section-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; box-shadow: 0 10px 24px rgba(2, 6, 23, .04); }

    /* Directory */
    .toolbar { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 12px; }
    .toolbar input, .toolbar select { padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); outline: none; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
    .person { border: 1px solid var(--border); border-radius: 14px; padding: 14px; background: linear-gradient(180deg, #fff, #fffdfb); display: grid; gap: 8px; }
    .tag { display: inline-block; background: #fde2e2; color: #7b241c; font-size: 12px; padding: 2px 8px; border-radius: 999px; border: 1px solid #f8caca; }
    .meta { color: var(--muted); font-size: 14px; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }

    /* Forms */
    form label { font-weight: 600; font-size: 13px; color: var(--muted); }
    form .field { display: grid; gap: 6px; }
    form input, form textarea, form select { padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); outline: none; }

    /* Calendar + Announcements */
    .calendar-hint { display:none; margin: 8px 0; padding: 10px 12px; background:#fff8db; border:1px solid #facc15; border-radius:10px; color:#92400e; font-size:14px; }
    .calendar-hint a { color: inherit; text-decoration: underline; }
    .cols { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    iframe.calendar { width: 100%; height: 520px; border: 1px solid var(--border); border-radius: 14px; }

    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(2,6,23,.45); display: none; align-items: center; justify-content: center; padding: 18px; }
    .modal.show { display: flex; }
    .modal > div { background: var(--card); border: 1px solid var(--border); border-radius: 16px; max-width: 640px; width: 100%; padding: 20px; }

    footer { padding: 34px 24px 80px; color: var(--muted); text-align: center; }
    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border: 1px dashed var(--border); border-radius: 999px; font-size: 12px; }

    /* Responsive */
    @media (max-width: 980px) {
      .quick { grid-template-columns: 1fr 1fr; }
      .grid { grid-template-columns: 1fr 1fr; }
      .cols { grid-template-columns: 1fr; }
    }
    @media (max-width: 640px) {
      .quick { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <noscript><div style="padding:12px;background:#fee2e2;color:#7f1d1d;text-align:center">This page works best with JavaScript enabled. You’re seeing a basic view.</div></noscript>
  <header>
    <nav class="nav container" aria-label="Primary">
      <div class="brand" aria-label="Site Home">
        <div class="brand-badge" aria-hidden="true">LR</div>
        <span>Lone Rock Ranch</span>
      </div>
      <div style="display:flex; gap:6px; flex-wrap:wrap;">
        <a class="active" href="#home">Home</a>
        <a href="#directory">Directory</a>
        <a href="#calendar">Calendar</a>
        <a href="#calendar-full">Full Calendar</a>
        <a href="#announcements">Announcements</a>
        <a href="#contact">Contact</a>
      </div>
    </nav>
  </header>

  <!-- New banner across the top -->
  <section class="banner">
    <div class="container">
      <h1>Welcome to the Lone Rock Ranch Hub</h1>
      <p>Plan trips, share updates, and keep everyone connected in one private place. Use the Directory to find contact info, check the Calendar for bookings, and post Announcements for the whole crew.</p>
      <div class="cta-row">
        <button class="btn primary" id="addMemberBtn">➕ Join the Directory</button>
        <a class="btn" href="#calendar-full">📅 View Calendar</a>
        <a class="btn secondary" href="#announcements">📣 Post Announcement</a>
      </div>
    </div>
  </section>

  <main id="home" class="container">
    <!-- QUICK LINKS -->
    <section class="hero">
      <div class="hero-card">
        <div class="quick">
          <div class="card">
            <h3>Google Chat</h3>
            <p>Launch the family chat.</p>
            <div class="row"><a href="#" id="chatLink">Open Group</a><span class="pill">Quick action</span></div>
          </div>
          <div class="card">
            <h3>Email Group</h3>
            <p>Send an email to everyone.</p>
            <div class="row"><a href="mailto:red-ranch@googlegroups.com" id="emailAll">red-ranch@googlegroups.com</a><span class="pill">All hands</span></div>
          </div>
          <div class="card">
            <h3>Share Photos</h3>
            <p>Upload trip photos.</p>
            <div class="row"><a href="#" id="photosLink">Open Folder</a><span class="pill">Memories</span></div>
          </div>
          <div class="card">
            <h3>Important Docs</h3>
            <p>House rules, Wi‑Fi, check‑in, etc.</p>
            <div class="row"><a href="#" id="docsLink">Open Binder</a><span class="pill">Reference</span></div>
          </div>
          <div class="card">
            <h3>Property Map</h3>
            <p>Directions & nearby spots.</p>
            <div class="row"><a href="#" id="mapLink">View Map</a><span class="pill">Wayfinding</span></div>
          </div>
          <div class="card">
            <h3>Emergency Info</h3>
            <p>Local hospitals & contacts.</p>
            <div class="row"><button class="btn" id="openEmergency">Open</button><span class="pill">Safety</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- DIRECTORY -->
    <section id="directory">
      <h2>Family Directory</h2>
      <div class="section-card">
        <div class="toolbar">
          <input id="search" type="search" placeholder="Search by name, branch, city…" aria-label="Search directory" />
          <select id="branchFilter" aria-label="Filter by branch">
            <option value="">All branches</option>
          </select>
          <button class="btn" id="exportBtn">⬇️ Export (.json)</button>
          <label class="btn" for="importFile" title="Import a previously exported JSON file">⬆️ Import <input id="importFile" type="file" accept="application/json" style="display:none"></label>
        </div>
        <div class="grid" id="people"></div>
      </div>
    </section>

    <!-- CALENDAR & ANNOUNCEMENTS (compact on home) -->
    <section id="calendar">
      <h2>Bookings & Events</h2>
      <div class="cols">
        <div class="section-card">
          <p style="margin-top:0;color:var(--muted)">Embed shows current bookings. Use the Full Calendar page for a larger view.</p>
          <iframe title="Lone Rock Ranch Calendar" class="calendar" src="https://calendar.google.com/calendar/embed?src=nq76a4kiv5v65vetalp5qbjmtv0@group.calendar.google.com&ctz=America%2FLos_Angeles"></iframe>
          <div class="calendar-hint">If the calendar doesn’t appear, your browser or viewer may be blocking embeds. <a target="_blank" rel="noreferrer" href="https://calendar.google.com/calendar/u/1?cid=bnE3NmE0a2l2NXY2NWV0YWxwNXFiam10djBAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ">Open in Google Calendar</a>.</div>
          <div class="row" style="margin-top:10px">
            <a class="btn" id="rsvpBtn" href="#contact">✉️ Send an RSVP</a>
            <a class="btn secondary" target="_blank" rel="noreferrer" href="https://calendar.google.com/calendar/u/1?cid=bnE3NmE0a2l2NXY2NWV0YWxwNXFiam10djBAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ">Open in Google Calendar</a>
          </div>
        </div>
        <div class="section-card" id="announcements">
          <div class="row" style="margin-bottom:8px">
            <h3 style="margin:0">Announcements</h3>
            <button class="btn" id="newPost">➕ New</button>
          </div>
          <div id="posts" style="display:grid; gap:10px"></div>
        </div>
      </div>
    </section>

    <!-- FULL CALENDAR PAGE -->
    <section id="calendar-full">
      <h2>Full Calendar</h2>
      <div class="section-card" style="padding:0">
        <iframe title="Lone Rock Ranch Calendar" class="calendar" style="height:80vh;border-radius:0;border:0;" src="https://calendar.google.com/calendar/embed?src=nq76a4kiv5v65vetalp5qbjmtv0@group.calendar.google.com&ctz=America%2FLos_Angeles&mode=MONTH"></iframe>
        <div class="calendar-hint" style="margin:8px 12px">If this embed is blocked, <a target="_blank" rel="noreferrer" href="https://calendar.google.com/calendar/u/1?cid=bnE3NmE0a2l2NXY2NWV0YWxwNXFiam10djBAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ">open the calendar directly</a>.</div>
        <div style="padding:12px;display:flex;gap:10px"><a class="btn" href="#home">⬅️ Back to Home</a><a class="btn secondary" target="_blank" rel="noreferrer" href="https://calendar.google.com/calendar/u/1?cid=bnE3NmE0a2l2NXY2NWV0YWxwNXFiam10djBAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ">Open in Google Calendar</a></div>
      </div>
    </section>

    <!-- CONTACT / RSVP -->
    <section id="contact">
      <h2>RSVP / Contact Organizers</h2>
      <div class="section-card">
        <form id="contactForm" class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px">
          <div class="field"><label for="cname">Your name</label><input id="cname" required placeholder="First & last name"></div>
          <div class="field"><label for="cemail">Your email</label><input id="cemail" type="email" required placeholder="you@example.com"></div>
          <div class="field"><label for="cbranch">Family branch</label><input id="cbranch" placeholder="e.g., Smith line"></div>
          <div class="field"><label for="cdates">Trip dates</label><input id="cdates" placeholder="e.g., Nov 21–24"></div>
          <div class="field" style="grid-column:1/-1"><label for="cmsg">Message</label><textarea id="cmsg" rows="4" placeholder="I’d like to book the cabin…"></textarea></div>
          <div style="grid-column:1/-1; display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn primary" type="submit">Send message</button>
            <span class="pill">Goes to: <span id="organizerEmail">airpope@gmail.com</span></span>
          </div>
        </form>
        <p style="margin:.5rem 0 0; color:var(--muted); font-size:13px">Tip: If you use Formspree or Basin, replace the JS handler with their form action for direct submissions.</p>
      </div>
    </section>
  </main>

  <footer>
    <div>© <span id="year"></span> Lone Rock Ranch • Private use only</div>
  </footer>

  <!-- Emergency Modal -->
  <div class="modal" id="emModal" role="dialog" aria-modal="true" aria-labelledby="emTitle">
    <div>
      <div class="row" style="margin-bottom:6px">
        <h3 id="emTitle" style="margin:0">Emergency Information</h3>
        <button class="btn" id="closeEmergency">Close</button>
      </div>
      <div style="display:grid; gap:8px; color:var(--muted)">
        <div><strong>Address:</strong> 30801 US-1 South, Gualala, CA</div>
        <div><strong>Nearest hospital:</strong> County Medical Center • (555) 222‑1000</div>
        <div><strong>Local contacts:</strong> Groundskeeper (555) 111‑2222 • Neighbor (555) 333‑4444</div>
        <div><strong>Wi‑Fi:</strong> Network: LoneRockRanch • Pass: lakes&trees</div>
      </div>
    </div>
  </div>

  <script>
    // --- UTIL ---
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    // Safe UUID (fallback for sandboxes)
    const uuid = () => (window.crypto && 'randomUUID' in crypto) ? crypto.randomUUID() : 'id-' + Math.random().toString(36).slice(2) + Date.now();

    // Safe storage wrapper (fallback to memory if localStorage blocked)
    const __MEM = {};
    const readStore = (k) => { try { return localStorage.getItem(k); } catch { return __MEM[k] ?? null; } };
    const writeStore = (k, v) => { try { localStorage.setItem(k, v); } catch { __MEM[k] = v; } };

    // --- STATIC LINKS (EDITABLE) ---
    const LINKS = {
      chat: "https://mail.google.com/chat/u/1/#chat/home",
      photos: "https://photos.google.com/u/1/?pageId=none",
      docs: "https://drive.google.com/drive/u/1/folders/1AkARHyXPfIiJXxtTcRPG0afmWAgwDET1",
      map: "https://duckduckgo.com/?q=30801+us1+south+gualala+ca&ia=web&iaxm=maps&source=maps",
      emailAll: "mailto:red-ranch@googlegroups.com",
      organizerEmail: "airpope@gmail.com"
    };

    // Optional: override via external /config.js (defines window.APP_CONFIG)
    const OVERRIDE = window.APP_CONFIG || {};
    for (const k in OVERRIDE) if (k in LINKS && OVERRIDE[k]) LINKS[k] = OVERRIDE[k];

    // Apply links
    $('#chatLink').href = LINKS.chat;
    $('#photosLink').href = LINKS.photos;
    $('#docsLink').href = LINKS.docs;
    $('#mapLink').href = LINKS.map;
    const emailAddress = LINKS.emailAll.replace(/^mailto:/, '');
    $('#emailAll').href = 'mailto:' + emailAddress;
    $('#emailAll').textContent = emailAddress;
    $('#organizerEmail').textContent = LINKS.organizerEmail;

    // Footer year
    $('#year').textContent = new Date().getFullYear();

    // Show calendar fallback hints until embeds load
    $$('.calendar').forEach((frame) => {
      const hint = frame.parentElement.querySelector('.calendar-hint');
      if (!hint) return;
      hint.style.display = 'block';
      frame.addEventListener('load', () => { hint.style.display = 'none'; });
      setTimeout(() => { hint.style.display = hint.style.display || 'block'; }, 2500);
    });

    // --- EMERGENCY MODAL ---
    $('#openEmergency').addEventListener('click', () => $('#emModal').classList.add('show'));
    $('#closeEmergency').addEventListener('click', () => $('#emModal').classList.remove('show'));
    $('#emModal').addEventListener('click', (e) => { if (e.target.id === 'emModal') $('#emModal').classList.remove('show'); });

    // --- FAMILY DIRECTORY ---
    const STORAGE_KEY = 'family_directory_v1';
    const BRANCHES_KEY = 'family_branches_v1';

    const seed = [
      { id: uuid(), name: 'Ava Thompson', branch: 'Thompson', city: 'Seattle, WA', email: 'ava@example.com', phone: '(555) 010-2000', notes: 'Loves hiking; has SUV' },
      { id: uuid(), name: 'Diego Rivera', branch: 'Rivera', city: 'San Diego, CA', email: 'diego@example.com', phone: '(555) 010-3000', notes: 'Has crib + high chair' },
      { id: uuid(), name: 'Maya Chen', branch: 'Chen', city: 'Austin, TX', email: 'maya@example.com', phone: '(555) 010-4000', notes: 'Allergic to cats' }
    ];

    function loadDirectory() {
      const data = JSON.parse(readStore(STORAGE_KEY) || 'null');
      if (!data) {
        writeStore(STORAGE_KEY, JSON.stringify(seed));
        writeStore(BRANCHES_KEY, JSON.stringify(['Thompson','Rivera','Chen']));
      }
      renderDirectory();
      populateBranchFilter();
    }

    function getPeople() { return JSON.parse(readStore(STORAGE_KEY) || '[]'); }
    function setPeople(list) { writeStore(STORAGE_KEY, JSON.stringify(list)); renderDirectory(); populateBranchFilter(); }

    function renderDirectory() {
      const query = ($('#search')?.value || '').toLowerCase();
      const branch = $('#branchFilter')?.value || '';
      const grid = $('#people');
      if (!grid) return;
      grid.innerHTML = '';
      let people = getPeople();
      if (branch) people = people.filter(p => p.branch === branch);
      if (query) people = people.filter(p => [p.name, p.branch, p.city, p.email, p.phone, p.notes].join(' ').toLowerCase().includes(query));
      people.forEach(p => grid.appendChild(personCard(p)));
    }

    function personCard(p) {
      const el = document.createElement('div');
      el.className = 'person';
      el.innerHTML = `
        <div class="row"><strong>${p.name}</strong><span class="tag">${p.branch || '—'}</span></div>
        <div class="meta">${p.city || ''}</div>
        <div class="meta">📧 <a href="mailto:${p.email}">${p.email}</a></div>
        <div class="meta">📱 ${p.phone || ''}</div>
        ${p.notes ? `<div class="meta">📝 ${p.notes}</div>` : ''}
        <div class="row">
          <button class="btn" aria-label="Edit ${p.name}" onclick='editPerson("${p.id}")'>Edit</button>
          <button class="btn" aria-label="Remove ${p.name}" onclick='removePerson("${p.id}")'>Remove</button>
        </div>
      `;
      return el;
    }

    function populateBranchFilter() {
      const select = $('#branchFilter');
      if (!select) return;
      const branches = [...new Set(getPeople().map(p => p.branch).filter(Boolean))];
      const current = select.value;
      select.innerHTML = '<option value="">All branches</option>' + branches.map(b => `<option ${b===current?'selected':''} value="${b}">${b}</option>`).join('');
    }

    function addOrEditPerson(existing=null) {
      const name = prompt('Full name', existing?.name || ''); if (!name) return;
      const branch = prompt('Family branch (e.g., Smith line)', existing?.branch || '');
      const city = prompt('City, State', existing?.city || '');
      const email = prompt('Email address', existing?.email || '');
      const phone = prompt('Phone number', existing?.phone || '');
      const notes = prompt('Notes (allergies, kids, gear, etc.)', existing?.notes || '');
      const people = getPeople();
      if (existing) {
        const idx = people.findIndex(p => p.id === existing.id);
        people[idx] = { ...existing, name, branch, city, email, phone, notes };
      } else {
        people.unshift({ id: uuid(), name, branch, city, email, phone, notes });
      }
      setPeople(people);
    }

    function editPerson(id) { const p = getPeople().find(p => p.id === id); if (p) addOrEditPerson(p); }
    function removePerson(id) { if (!confirm('Remove this person from the directory?')) return; setPeople(getPeople().filter(p => p.id !== id)); }

    $('#addMemberBtn').addEventListener('click', () => addOrEditPerson());
    $('#search')?.addEventListener('input', renderDirectory);
    $('#branchFilter')?.addEventListener('change', renderDirectory);

    // Export / Import JSON
    $('#exportBtn')?.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(getPeople(), null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'family-directory.json'; a.click();
      URL.revokeObjectURL(url);
    });
    $('#importFile')?.addEventListener('change', (e) => {
      const file = e.target.files?.[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try { const data = JSON.parse(reader.result); if (Array.isArray(data)) setPeople(data); else alert('Invalid file'); }
        catch { alert('Invalid JSON'); }
      };
      reader.readAsText(file);
      e.target.value = '';
    });

    // --- ANNOUNCEMENTS ---
    const POSTS_KEY = 'family_posts_v1';
    function getPosts() { return JSON.parse(readStore(POSTS_KEY) || '[]'); }
    function setPosts(v) { writeStore(POSTS_KEY, JSON.stringify(v)); renderPosts(); }

    function renderPosts() {
      const wrap = $('#posts');
      if (!wrap) return;
      wrap.innerHTML = '';
      const posts = getPosts();
      if (!posts.length) {
        const empty = document.createElement('div');
        empty.className = 'meta';
        empty.textContent = 'No announcements yet. Be the first to post!';
        wrap.appendChild(empty);
        return;
      }
      posts.forEach(p => {
        const card = document.createElement('div');
        card.className = 'person';
        card.innerHTML = `
          <div class="row"><strong>${p.title}</strong><span class="meta">${new Date(p.ts).toLocaleString()}</span></div>
          <div class="meta">${p.body}</div>
          <div class="row">
            ${p.author ? `<span class="meta">— ${p.author}</span>` : '<span></span>'}
            <button class="btn" onclick='deletePost("${p.id}")'>Delete</button>
          </div>
        `;
        wrap.appendChild(card);
      });
    }

    function newPost() {
      const title = prompt('Announcement title'); if (!title) return;
      const body = prompt('What\'s the update?'); if (!body) return;
      const author = prompt('Your name (optional)') || '';
      const posts = getPosts();
      posts.unshift({ id: uuid(), title, body, author, ts: Date.now() });
      setPosts(posts);
    }
    function deletePost(id) { if (!confirm('Delete this announcement?')) return; setPosts(getPosts().filter(x => x.id !== id)); }
    $('#newPost')?.addEventListener('click', newPost);

    // --- CONTACT FORM (mailto fallback) ---
    $('#contactForm')?.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = $('#cname').value.trim();
      const email = $('#cemail').value.trim();
      const branch = $('#cbranch').value.trim();
      const dates = $('#cdates').value.trim();
      const msg = $('#cmsg').value.trim();
      const body = encodeURIComponent(`Name: ${name}
Email: ${email}
Branch: ${branch}
Dates: ${dates}

Message:
${msg}`);
      window.location.href = `mailto:${LINKS.organizerEmail}?subject=${encodeURIComponent('RSVP / Inquiry from ' + name)}&body=${body}`;
    });

    // Init
    loadDirectory();
    renderPosts();
  </script>
</body>
</html>
